<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<beast beautitemplate='Standard' beautistatus='' namespace="beast.pkgmgmt:beast.base.core:beast.base.inference:beast.base.evolution.alignment:beast.base.evolution.tree.coalescent:beast.base.util:beast.base.math:beast.evolution.nuc:beast.base.evolution.operator:beast.base.inference.operator:beast.base.evolution.sitemodel:beast.base.evolution.substitutionmodel:beast.base.evolution.likelihood" version="2.7">
    

    <mergewith point='aux-sitemodel-panels'>

        <subtemplate id='Free rate model' class='rbbeast.evolution.sitemodel.FreeRateModel' mainid='FreeRateModel.s:$(n)'
			>
            <![CDATA[

        <parameter dimension="4" estimate="true" id="FreeRateRates.s:$(n)" lower="0.01" name="stateNode" upper="100.0" value="0.25"/>
        <parameter dimension="4" estimate="false" id="FreeRateWeights.s:$(n)" lower="0.001" name="stateNode" upper="100.0" value="0.25"/>

        <prior id="FreeRatesRatePrior.s:$(n)" name="distribution" x="@FreeRateRates.s:$(n)">
                <distr spec="distribution.Dirichlet" alpha="1.0 1.0 1.0 1.0"/>
        </prior>
        <prior id="FreeRatesWeightPrior.s:$(n)" name="distribution" x="@FreeRateWeights.s:$(n)">
                <distr spec="distribution.Dirichlet" alpha="4.0 4.0 4.0 4.0"/>
        </prior>

        <siteModel id="FreeRateModel.s:$(n)" spec="rbbeast.evolution.sitemodel.FreeRateModel" rates='@FreeRateRates.s:$(n)' weights='@FreeRateWeights.s:$(n)'
            incremental="true">
            <parameter id="mutationRate.s:$(n)" spec="parameter.RealParameter" estimate="false" name="mutationRate">1.0</parameter>
            <parameter id="proportionInvariant.s:$(n)" spec="parameter.RealParameter" estimate="false" lower="0.0" name="proportionInvariant" upper="1.0">0.0</parameter>
            <substModel spec='JukesCantor' id='JC69.s:$(n)'/>
        </siteModel>

	    <operator id="FreeRatesWeightExchanger.s:$(n)" spec="DeltaExchangeOperator" delta="0.01" weight="1.0">
    	    <parameter idref="FreeRateWeights.s:$(n)"/>
	    </operator>
    	<operator id="FreeRatesRateExchanger.s:$(n)" spec="DeltaExchangeOperator" delta="0.01" weight="1.0">
	        <parameter idref="FreeRateRates.s:$(n)"/>
    	</operator>

        <log id="FreeRateLogger.s:$(n)" spec="rbbeast.evolution.util.FreeRateLogger" model="@FreeRateModel.s:$(n)" maxCategoryCount="10"/>

            ]]>


            <connect method="beastfx.app.inputeditor.SiteModelInputEditor.customConnector"/>

            <connect srcID='FreeRateRates.s:$(n)'              targetID='state' inputName='stateNode' if='inlikelihood(FreeRateModel.s:$(n)) and FreeRateRates.s:$(n)/estimate=true'/>
            <connect srcID='FreeRateWeights.s:$(n)'            targetID='state' inputName='stateNode' if='inlikelihood(FreeRateModel.s:$(n)) and FreeRateWeights.s:$(n)/estimate=true'/>

            <connect srcID='FreeRatesRatePrior.s:$(n)'         targetID='prior' inputName='distribution' if='inlikelihood(FreeRateModel.s:$(n)) and FreeRateRates.s:$(n)/estimate=true'/>
            <connect srcID='FreeRatesWeightPrior.s:$(n)'       targetID='prior' inputName='distribution' if='inlikelihood(FreeRateModel.s:$(n)) and FreeRateWeights.s:$(n)/estimate=true'/>

            <connect srcID='FreeRatesRateExchanger.s:$(n)'     targetID='mcmc' inputName='operator' if='inlikelihood(FreeRateModel.s:$(n)) and FreeRateRates.s:$(n)/estimate=true'>Exchanges free rate model rates of partition s:$(n)</connect>
            <connect srcID='FreeRatesWeightExchanger.s:$(n)'   targetID='mcmc' inputName='operator' if='inlikelihood(FreeRateModel.s:$(n)) and FreeRateWeights.s:$(n)/estimate=true'>Exchanges free rate model weights of partition s:$(n)</connect>
            
            <connect srcID='FreeRateLogger.s:$(n)'             targetID='tracelog' inputName='log' if='inlikelihood(FreeRateModel.s:$(n))'/>

            </subtemplate>
    </mergewith>

</beast>
